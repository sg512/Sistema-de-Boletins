$(function(){function e(e){var o={"â":"a","Â":"A","à":"a","À":"A","á":"a","Á":"A","ã":"a","Ã":"A","ê":"e","Ê":"E","è":"e","È":"E","é":"e","É":"E","î":"i","Î":"I","ì":"i","Ì":"I","í":"i","Í":"I","õ":"o","Õ":"O","ô":"o","Ô":"O","ò":"o","Ò":"O","ó":"o","Ó":"O","ü":"u","Ü":"U","û":"u","Û":"U","ú":"u","Ú":"U","ù":"u","Ù":"U","ç":"c","Ç":"C"};return e.replace(/[\W\[\] ]/g,function(e){return o[e]||e})}function o(){if(""==$("#palavras").val())return a("tagit","class"),!1;switch($("#search_slct_tipo_vsl").val()){case"ano":if(""==$("#search_slct_ano_bol").val())return a("search_slct_tipo_vsl","id"),!1;break;case"periodo":if(""==$("#search_datepicker_from").val()||""==$("#search_datepicker_to").val())return a("search_datepicker_from","id"),a("search_datepicker_to","id"),!1;break;default:return a("search_slct_tipo_vsl","id"),!1}}function a(e,o){"id"==o?$("#"+e).css({"border-left":"20px solid #D9534F "}):"class"==o&&$("."+e).css({"border-left":"20px solid #D9534F "})}function r(o,a){for(var r=o.split(" "),t=a.split(","),s=[],i=0,n=0;n<t.length;n++)for(var c=0;c<r.length;c++)r[c].toUpperCase()==e(t[n].toUpperCase())&&(s[i]=c,i++);return s}function t(o,a,r,t,s){for(var i=[],n=[],c="",l="",d=o;a>=d;d++){i[d]=t[d],n[d]=s[d];for(var p=0;p<=r.length;p++)void 0!=i[d]&&void 0!=r[p]&&(c=i[d],l=e(r[p].toUpperCase()),c==l&&(n[d]="<mark><strong>"+n[d]+"</strong></mark>"))}return n}function s(e,o,a,r){var s=a.split(" "),i=r.split(" "),n=[],c=10,l="",d=0,p=0,h=0;o=o.split(",");for(var m=0;m<e.length;m++){d=e[m]-c,p=e[m]+c,0>d&&(d=0),p>e[m].length&&(p=e[m].length),n=t(d,p,o,s,i);for(var u=d;p>=u;u++)u==d&&(h++,l=l+h+"º ..."),l=l+" "+n[u],u==p&&(l+="... <br>")}return l}function n(e,o,a,t){var s="",i="";return i=r(o[e].conteudo,t).length<=1?"aparição":"aparições",s=s+"<div id='titulo_"+o[e].uploadid+"' class='controle'><strong>"+(e+1)+")</strong> + "+r(o[e].conteudo,t).length+" "+i+" no boletim  <strong>"+o[e].nome+"</strong> de <strong>"+o[e].data+"</strong> -  <a href='"+o[e].url+"' target='_blank'><i class='glyphicon glyphicon-export'></i></a></div>",s=s+"<div id='conteudo_"+o[e].uploadid+"' class='controle_conteudo' style='display: none'><p class='paragrafo_conteudo'>"+a+"</p></div>"}$("#palavras").tagit({fieldName:"skills",availableTags:["boletim","teste","php","javascript","ruby","python","c"]});var c=$("#searchBoletins").dataTable({dom:'<"top">rt<"bottom"ip><"clear">',pagingType:"full_numbers",pageLength:20,oLanguage:{sProcessing:"Aguarde enquanto os dados são carregados ...",sLengthMenu:"Mostrar _MENU_ registros por pagina",sZeroRecords:"Nenhum registro correspondente ao critério encontrado..",sInfoEmtpy:"Exibindo 0 a 0 de 0 registros",sInfo:"Exibindo de _START_ a _END_ de _TOTAL_ registros",sInfoFiltered:"",sLoadingRecords:"Carregando...",sSearch:"Procurar",oPaginate:{sFirst:"<i class='glyphicon glyphicon-fast-backward'></i> ",sPrevious:" <i class='glyphicon glyphicon-step-backward'></i>",sNext:" <i class='glyphicon glyphicon-step-forward'></i>",sLast:" <i class='glyphicon glyphicon-fast-forward'></i>"}},columns:[{width:"100%",type:"num"}]});$("#search_datepicker_from").mask("99/99/9999",{placeholder:"dd/mm/yyyy"}),$("#search_datepicker_to").mask("99/99/9999",{placeholder:"dd/mm/yyyy"}),$("#dialog-message").dialog({autoOpen:!1,modal:!0,close:function(){$("#message_alert").empty()}}),$("#search_datepicker_from").datepicker({dateFormat:"dd/mm/yy",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior",defaultDate:"+1w",changeMonth:!0,numberOfMonths:3,onClose:function(e){$("#search_datepicker_from").css({"border-left":""}),$("#search_datepicker_to").datepicker("option","minDate",e)}}),$("#search_datepicker_to").datepicker({dateFormat:"dd/mm/yy",dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior",defaultDate:"+1w",changeMonth:!0,numberOfMonths:3,onClose:function(e){$("#search_datepicker_to").css({"border-left":""}),$("#search_datepicker_to").datepicker("option","maxDate",e)}}),$.get("search/getPeriodoAno",function(e){for(var o=0;o<e.length;o++)for(var a=e[o].data_minima.split("-"),r=e[o].data_maxima.split("-"),t=r[0];t>=a[0];t--)$("#search_slct_ano_bol").append($("<option>",{value:t,text:t}))},"json"),$(".tagit").focusout(function(){$(".tagit").css({"border-left":""})}),$("#search_slct_tipo_vsl").on("change",function(){"ano"==$(this).find(":selected").val()?($("#search_li_ano_bol").show(),$("#search_periodo_icon").hide(),$("#search_periodo_bol_from").hide(),$("#search_periodo_bol_to").hide()):"periodo"==$(this).find(":selected").val()?($("#search_periodo_icon").show(),$("#search_periodo_bol_from").show(),$("#search_periodo_bol_to").show(),$("#search_li_ano_bol").hide()):"selecione"==$(this).find(":selected").val()&&($("#search_periodo_icon").hide(),$("#search_periodo_bol_from").hide(),$("#search_periodo_bol_to").hide(),$("#search_li_ano_bol").hide())}),$("#FrmBolSrch").submit(function(e){$("#mostra_boletins").hide("fast"),e.preventDefault(),c.fnClearTable();var a=new FormData($(this)[0]),t="";return 0!=o()?$.ajax({url:"search/listaBoletinsFTS",type:"POST",data:a,async:!1,cache:!1,contentType:!1,enctype:"multipart/form-data; charset=UTF-8",processData:!1,success:function(e){var o=$.parseJSON(e);if(o.length>0)for(i=0;i<o.length;i++)t=s(r(o[i].conteudo,a.get("palavras").trim()),a.get("palavras").trim(),o[i].conteudo,o[i].conteudo_mantido),""==t.trim()&&(t="<br><strong>O sistema não encontrou somente a <mark>palavra</mark> e sim partes dela citadas no BI.</strong>",t+="<br>Ex.: fora pesquisado '<mark>teste</mark>' e foi localizado '<mark>teste</mark>munha'..",t+="<br>Acesse o B.I. através do link no título para constatar o fato ocorrido."),c.fnAddData([n(i,o,t,a.get("palavras").trim())]);else $("#message_alert").append("Não há boletins com esses dados inseridos.."),$("#dialog-message").dialog("open")}}):($("#message_alert").append("Preencha os campos assinalados em vermelho corretamente.."),$("#dialog-message").dialog("open")),$("#mostra_boletins").show("fast"),!1}),$("#searchBoletins tbody").on("click","div.controle",function(){var e=$(this).attr("id").split("_");e="#conteudo_"+e[1],$(e).toggle()})});